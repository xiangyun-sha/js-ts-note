# 操作符与表达式

[TOC]

---

操作符（Operator）是用于执行操作的符号，它们作用于操作数（Operand）并产生结果。表达式（Expression）是由操作数和操作符组成的语法单元，每个表达式都会计算得到一个值。JavaScript 提供了丰富的操作符，涵盖了算术、比较、逻辑、位运算、赋值等多种功能。理解这些操作符及其行为是掌握 JavaScript 的基础。

本章将分类介绍 JavaScript 中的常用操作符，并通过示例说明其用法和注意事项。最后，我们将讨论运算符优先级，帮助你写出正确且易读的代码。

---

## 1. 算术运算符

算术运算符用于执行数学运算，操作数和结果均为数值（注意加法可能涉及字符串拼接）。

| 运算符 | 描述           | 示例           | 结果  |
| ------ | -------------- | -------------- | ----- |
| `+`    | 加法           | `5 + 3`        | `8`   |
| `-`    | 减法           | `5 - 3`        | `2`   |
| `*`    | 乘法           | `5 * 3`        | `15`  |
| `/`    | 除法           | `5 / 2`        | `2.5` |
| `%`    | 取余（模运算） | `5 % 2`        | `1`   |
| `**`   | 指数（ES2016） | `5 ** 2`       | `25`  |
| `++`   | 递增           | `let a=5; a++` | `6`   |
| `--`   | 递减           | `let b=5; b--` | `4`   |

### 注意事项

- **加法运算符的特殊性**：如果任一操作数是字符串，则 `+` 执行字符串拼接。

  ```javascript
  console.log(5 + '3'); // "53"
  console.log('Hello ' + 'World'); // "Hello World"
  ```

  其他算术运算符会尝试将字符串转换为数字（如果无法转换则得到 `NaN`）。
- **递增/递减**：前置递增（`++a`）先自增后返回；后置递增（`a++`）先返回原值后自增。
- **除法**：结果可能是浮点数，整数除法需使用 `Math.floor` 等。
- **取余**：结果的符号与被除数相同。

  ```javascript
  console.log(-5 % 2); // -1
  console.log(5 % -2); // 1
  ```

---

## 2. 比较运算符

比较运算符用于比较两个值的大小或相等性，返回布尔值（`true` 或 `false`）。

| 运算符 | 描述                     | 示例        | 结果    |
| ------ | ------------------------ | ----------- | ------- |
| `>`    | 大于                     | `5 > 3`     | `true`  |
| `<`    | 小于                     | `5 < 3`     | `false` |
| `>=`   | 大于等于                 | `5 >= 3`    | `true`  |
| `<=`   | 小于等于                 | `5 <= 3`    | `false` |
| `==`   | 相等（允许类型转换）     | `5 == '5'`  | `true`  |
| `!=`   | 不相等（允许类型转换）   | `5 != '5'`  | `false` |
| `===`  | 严格相等（禁止类型转换） | `5 === '5'` | `false` |
| `!==`  | 严格不相等               | `5 !== '5'` | `true`  |

### 严格相等 vs. 抽象相等

- **严格相等（`===` / `!==`）**：比较时不进行类型转换，要求类型和值都相同。推荐始终使用严格相等，避免因隐式转换带来的意外结果。
- **抽象相等（`==` / `!=`）**：允许类型转换，规则复杂，容易产生混淆。例如 `0 == false` 为 `true`，`'' == 0` 为 `true`。应尽量避免使用。

### 特殊比较

- **NaN**：与任何值（包括自身）都不相等，包括使用 `==` 或 `===`。判断 `NaN` 应使用 `Number.isNaN()`。
- **对象比较**：比较的是引用，而非结构内容。两个不同的对象即使内容相同，也不相等。

  ```javascript
  {} == {}  // false
  [] == []  // false
  ```

---

## 3. 逻辑运算符

逻辑运算符常用于布尔逻辑运算，通常与条件判断结合使用。

| 运算符 | 描述   | 示例              | 结果    |
| ------ | ------ | ----------------- | ------- |
| `&&`   | 逻辑与 | `true && false`   | `false` |
| `\|\|` | 逻辑或 | `true \|\| false` | `true`  |
| `!`    | 逻辑非 | `!true`           | `false` |

### 短路求值

- `&&`：若第一个操作数为假值（`false`、`0`、`''`、`null`、`undefined`、`NaN`），则返回第一个操作数；否则返回第二个操作数。

  ```javascript
  console.log(0 && 'hello'); // 0
  console.log(5 && 'hello'); // 'hello'
  ```

- `||`：若第一个操作数为真值，则返回第一个操作数；否则返回第二个操作数。

  ```javascript
  console.log(5 || 'hello'); // 5
  console.log(0 || 'hello'); // 'hello'
  ```

短路特性常被用于设置默认值或条件执行。

### 逻辑非的连续使用

- `!!` 可将任意值转换为布尔值（相当于 `Boolean()`）。

  ```javascript
  console.log(!!'hello'); // true
  console.log(!!0);       // false
  ```

---

## 4. 位运算符

位运算符将操作数视为 32 位整数，对其二进制位进行操作。在实际开发中，位运算符常用于底层优化、权限控制或特定算法。

| 运算符 | 描述       | 示例      | 结果（十进制） | 说明                     |
| ------ | ---------- | --------- | -------------- | ------------------------ |
| `&`    | 按位与     | `5 & 1`   | `1`            | 101 & 001 = 001          |
| `\|`   | 按位或     | `5 \| 1`  | `5`            | 101 \| 001 = 101         |
| `^`    | 按位异或   | `5 ^ 1`   | `4`            | 101 ^ 001 = 100          |
| `~`    | 按位非     | `~5`      | `-6`           | 按位取反（包括符号位）   |
| `<<`   | 左移       | `5 << 1`  | `10`           | 101 << 1 = 1010          |
| `>>`   | 右移       | `5 >> 1`  | `2`            | 101 >> 1 = 10 (保留符号) |
| `>>>`  | 无符号右移 | `5 >>> 1` | `2`            | 左侧补0                  |

### 注意事项

- 位运算仅对 32 位整数有效，超出范围会被截断。
- 实际开发中，位运算常用于：
  - 权限组合（如 Linux 文件权限）
  - 高效判断奇偶（`n & 1` 判断是否奇数）
  - 快速乘除 2 的幂（左移相当于乘以 2，右移相当于整除 2）

---

## 5. 赋值运算符

赋值运算符用于将值赋给变量。最基础的赋值运算符是 `=`，此外还有复合赋值运算符。

| 运算符 | 描述             | 示例       | 等价于        |
| ------ | ---------------- | ---------- | ------------- |
| `=`    | 赋值             | `x = y`    |               |
| `+=`   | 加后赋值         | `x += y`   | `x = x + y`   |
| `-=`   | 减后赋值         | `x -= y`   | `x = x - y`   |
| `*=`   | 乘后赋值         | `x *= y`   | `x = x * y`   |
| `/=`   | 除后赋值         | `x /= y`   | `x = x / y`   |
| `%=`   | 取余后赋值       | `x %= y`   | `x = x % y`   |
| `**=`  | 指数后赋值       | `x **= y`  | `x = x ** y`  |
| `<<=`  | 左移后赋值       | `x <<= y`  | `x = x << y`  |
| `>>=`  | 右移后赋值       | `x >>= y`  | `x = x >> y`  |
| `>>>=` | 无符号右移后赋值 | `x >>>= y` | `x = x >>> y` |
| `&=`   | 按位与后赋值     | `x &= y`   | `x = x & y`   |
| `\|=`  | 按位或后赋值     | `x \|= y`  | `x = x \| y`  |
| `^=`   | 按位异或后赋值   | `x ^= y`   | `x = x ^ y`   |

### 链式赋值

赋值表达式本身也有值，即赋给变量的值。因此可以进行链式赋值：

```javascript
let a, b, c;
a = b = c = 5; // 从右向左结合，相当于 c = 5; b = c; a = b;
console.log(a, b, c); // 5 5 5
```

### 注意

- 赋值操作返回的值是右侧表达式的值，而非变量引用。

---

## 6. 身份运算符（严格相等运算符）

在许多编程语言中，“身份运算符”指的是比较两个对象是否引用同一个实例。在 JavaScript 中，通常我们使用严格相等运算符 `===` 和 `!==` 来比较值和类型，但严格相等并不直接判断“身份”（对于对象，它比较的是引用；对于原始值，比较的是值）。严格相等在判断对象时，确实可以视为“引用同一性”，即是否为同一个对象。因此，本节介绍 `===` 和 `!==` 在对象引用比较方面的意义。

- **`===`**：比较两个值是否严格相等。对于原始类型，比较值；对于引用类型，比较引用地址（即是否指向同一个对象）。
- **`!==`**：严格不相等。

```javascript
let obj1 = { name: 'Alice' };
let obj2 = { name: 'Alice' };
let obj3 = obj1;

console.log(obj1 === obj2); // false，不同对象
console.log(obj1 === obj3); // true，引用相同
```

在多数情况下，我们所说的“身份比较”就是指使用 `===` 判断两个变量是否引用同一对象。

**注意**：对于原始类型，`===` 比较的是值，不存在“身份”概念。

---

## 7. 成员运算符

成员运算符用于访问对象的属性或数组的元素。在 JavaScript 中，主要有两种方式：点号表示法和方括号表示法。

### 7.1 点号表示法（`.`）

- 语法：`对象.属性名`
- 属性名必须是合法的标识符（不能以数字开头，不能包含空格等）。
- 简洁常用，但属性名是固定的，不能使用变量。

```javascript
const person = { name: 'Alice', age: 30 };
console.log(person.name); // 'Alice'
```

### 7.2 方括号表示法（`[]`）

- 语法：`对象[表达式]`
- 表达式的结果会转换为字符串作为属性名。
- 可以使用变量作为属性名，也可以使用特殊字符的属性名（如包含空格或连字符）。

```javascript
const propName = 'age';
console.log(person[propName]); // 30
console.log(person['na' + 'me']); // 'Alice'
console.log(person['first name']); // 如果属性名包含空格，必须用方括号
```

### 7.3 可选链操作符（`?.`）

ES2020 引入了可选链操作符，用于安全地访问嵌套对象的属性，避免因中间属性为 `null` 或 `undefined` 而抛出错误。

- 语法：`对象?.属性` 或 `对象?.[表达式]`
- 如果左侧的值为 `null` 或 `undefined`，表达式短路返回 `undefined`，而不是报错。

```javascript
const user = { profile: { name: 'Alice' } };
console.log(user.profile?.name);   // 'Alice'
console.log(user.address?.city);   // undefined，不会报错
```

---

## 8. 运算符优先级

运算符优先级决定了在表达式中哪个运算符先被计算。当多个运算符出现在同一表达式中时，优先级高的运算符先执行。如果优先级相同，则根据结合性决定计算顺序（从左到右或从右到左）。

以下是 JavaScript 中常见运算符的优先级（从高到低），可参考 [MDN 运算符优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence) 获取完整列表。

| 优先级 | 运算符类别                                            | 运算符                                                                            | 结合性   |
| ------ | ----------------------------------------------------- | --------------------------------------------------------------------------------- | -------- |
| 20     | 分组                                                  | `( … )`                                                                           | 不适用   |
| 19     | 成员访问、new（带参数）                               | `… . …`、`… [ … ]`、`new … ( … )`                                                 | 从左到右 |
| 18     | 函数调用、可选链                                      | `… ( … )`、`?.`                                                                   | 从左到右 |
| 17     | new（无参数）                                         | `new …`                                                                           | 从右到左 |
| 16     | 后置递增/递减                                         | `… ++`、`… --`                                                                    | 不适用   |
| 15     | 逻辑非、按位非、一元加减、typeof、void、delete、await | `! …`、`~ …`、`+ …`、`- …`、`typeof …`、`void …`、`delete …`、`await …`           | 从右到左 |
| 14     | 指数                                                  | `… ** …`                                                                          | 从右到左 |
| 13     | 乘、除、取余                                          | `… * …`、`… / …`、`… % …`                                                         | 从左到右 |
| 12     | 加、减                                                | `… + …`、`… - …`                                                                  | 从左到右 |
| 11     | 按位移                                                | `… << …`、`… >> …`、`… >>> …`                                                     | 从左到右 |
| 10     | 比较                                                  | `<`、`<=`、`>`、`>=`、`in`、`instanceof`                                          | 从左到右 |
| 9      | 相等性                                                | `==`、`!=`、`===`、`!==`                                                          | 从左到右 |
| 8      | 按位与                                                | `&`                                                                               | 从左到右 |
| 7      | 按位异或                                              | `^`                                                                               | 从左到右 |
| 6      | 按位或                                                | `\|`                                                                              | 从左到右 |
| 5      | 逻辑与                                                | `&&`                                                                              | 从左到右 |
| 4      | 逻辑或                                                | `\|\|`                                                                            | 从左到右 |
| 3      | 条件（三元）                                          | `… ? … : …`                                                                       | 从右到左 |
| 2      | 赋值                                                  | `=`、`+=`、`-=`、`**=`、`*=`、`/=`、`%=`、`<<=`、`>>=`、`>>>=`、`&=`、`^=`、`\|=` | 从右到左 |
| 1      | 逗号                                                  | `,`                                                                               | 从左到右 |

### 最佳实践

- 当不确定优先级时，使用括号 `()` 明确指定计算顺序，这能提高代码可读性并避免错误。
- 不要过度依赖运算符优先级，尤其是在混合多种运算符时，括号是更好的文档。

**示例**：

```javascript
let result = 2 + 3 * 4;    // 14，因为 * 优先级高于 +
let withParen = (2 + 3) * 4; // 20

let a = 5, b = 10;
let c = a > b ? a : b;     // 三元运算符优先级较低，但整个表达式清晰
```

---

## 小结

操作符是表达式的核心构件，JavaScript 提供了丰富的操作符来支持各种运算。本章我们学习了：

- **算术运算符**：执行数学运算，注意加法特殊处理字符串。
- **比较运算符**：比较值，推荐使用严格相等 `===` 避免类型转换。
- **逻辑运算符**：支持短路求值，常用于条件判断和默认值设置。
- **位运算符**：操作二进制位，适用于底层优化。
- **赋值运算符**：将值赋给变量，包括复合赋值。
- **身份运算符**：在对象引用比较中指 `===`。
- **成员运算符**：访问对象属性，包括点号、方括号和可选链。
- **运算符优先级**：决定表达式求值顺序，必要时用括号明确。

熟练掌握这些操作符，能够让你编写出更精确、高效的 JavaScript 代码。下一章我们将学习语句与流程控制，了解如何控制程序的执行路径。

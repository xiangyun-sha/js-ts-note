# 虚拟DOM（virtual DOM） 和 虚拟节点（vNode）

[TOC]

---

vDOM 和 vNode 是现代前端框架（如 Vue、React）中用于提升性能和开发体验的核心概念。下面简单介绍一下它们是什么以及它们之间的关系。

---

## vNode（虚拟节点）

- **是什么**  
  vNode 是一个普通的 JavaScript 对象，用来描述一个真实的 DOM 节点。  
  它通常包含以下信息：
  - **节点类型**：如元素节点（div、p）、文本节点、组件节点等。
  - **属性**：节点的属性（如 class、id、事件监听器）。
  - **子节点**：可能是一个 vNode 数组，也可以是字符串（文本节点）。
  - **其他元数据**：如 key（用于优化列表更新）。

  例如，一个 `<div class="foo">Hello</div>` 的 vNode 大致如下：

  ```js
  {
    type: 'div',
    props: { class: 'foo' },
    children: ['Hello']
  }
  ```

- **作用**  
  vNode 是真实 DOM 的轻量级表示，它只存在于内存中，不直接渲染到页面上。通过它我们可以快速创建、修改节点，而无需频繁操作浏览器提供的真实 DOM。

---

## vDOM（虚拟 DOM）

- **是什么**  
  vDOM 是一棵由 vNode 组成的树形结构，它完整地反映了真实 DOM 的结构。  
  可以理解为：整个页面（或组件）的虚拟表示，是一个用 JavaScript 对象构建的“镜像”树。

  例如，下面的 HTML：

  ```html
  <div id="app">
    <h1>Title</h1>
    <p>Content</p>
  </div>
  ```

  对应的 vDOM 就是由三个 vNode（div、h1、p）组成的树。

- **如何工作**  
  1. **初次渲染**：根据组件状态生成 vDOM 树，然后由框架将其转换为真实的 DOM 并插入页面。  
  2. **状态更新**：当数据变化时，会生成一棵新的 vDOM 树。  
  3. **比较差异（Diff）**：将新 vDOM 树与旧的 vDOM 树进行对比，找出哪些节点发生了变化。  
  4. **最小化更新**：只将变化的部分应用到真实 DOM 上，避免全量重绘。

---

## 为什么需要 vDOM 和 vNode？

- **性能优化**  
  直接操作真实 DOM 非常昂贵（会引起重排、重绘）。通过 vDOM 在内存中进行操作，再用 Diff 算法批量更新真实 DOM，可以显著减少不必要的 DOM 操作，提升性能。
- **跨平台能力**  
  vDOM 是对 UI 的抽象描述，不依赖浏览器环境。因此可以轻松渲染到不同平台，如 React Native（渲染为原生组件）、小程序等。
- **声明式开发**  
  开发者只需关注状态变化，框架自动通过 vDOM 完成视图更新，简化了手动操作 DOM 的繁琐过程。

---

## 小结

- **vNode** 是构成 vDOM 的基本单元，描述单个节点。  
- **vDOM** 是由 vNode 组成的树，是真实 DOM 的虚拟映射。  
- 两者共同实现了一种高效的 UI 更新机制，让前端开发更高效、更灵活。
